// https://d3-geomap.github.io v3.3.0 Copyright 2020 Ramiro GÃ³mez
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("d3-selection"),require("d3-transition"),require("topojson"),require("d3-fetch"),require("d3-geo"),require("d3-array"),require("d3-scale"),require("d3-format")):"function"==typeof define&&define.amd?define(["exports","d3-selection","d3-transition","topojson","d3-fetch","d3-geo","d3-array","d3-scale","d3-format"],e):e((t=t||self).d3=t.d3||{},t.d3,t.d3,t.topojson,t.d3,t.d3,t.d3,t.d3,t.d3)}(this,function(t,e,r,n,o,i,a,p,s){"use strict";function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,r){return e&&l(t.prototype,e),r&&l(t,r),t}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function g(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var r,n,o,i=f(t);if(e){var a=f(this).constructor;r=Reflect.construct(i,arguments,a)}else r=i.apply(this,arguments);return n=this,!(o=r)||"object"!=typeof o&&"function"!=typeof o?h(n):o}}function v(t,e,r){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=f(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(r):o.value}})(t,e,r||t)}function y(t,e,r){t[e]=function(n){return void 0===n?t.properties[e]||r:(t.properties[e]=n,t)}}var m=function(){function t(){for(var e in c(this,t),this.properties={geofile:null,geoData:null,height:null,postUpdate:null,projection:i.geoNaturalEarth1,rotate:[0,0,0],scale:null,translate:null,unitId:"iso3",unitPrefix:"unit-",units:"units",unitTitle:function(t){return t.properties.name},width:null,zoomFactor:4},this.properties)y(this,e,this.properties[e]);this._={}}return u(t,[{key:"clicked",value:function(t){var e=this,r=1,n=this.properties.width/2,o=this.properties.height/2,i=n,a=o;if(t&&t.hasOwnProperty("geometry")&&this._.centered!==t){var p=this.path.centroid(t);i=p[0],a=p[1],r=this.properties.zoomFactor,this._.centered=t}else this._.centered=null;this.svg.selectAll("path.unit").classed("active",this._.centered&&function(t){return t===e._.centered}),this.svg.selectAll("g.zoom").transition().duration(750).attr("transform","translate(".concat(n,", ").concat(o,")scale(").concat(r,")translate(-").concat(i,", -").concat(a,")"))}},{key:"draw",value:function(t){var e=this,r=this;r.data=t.datum(),r.properties.width||(r.properties.width=t.node().getBoundingClientRect().width),r.properties.height||(r.properties.height=r.properties.width/1.92),r.properties.scale||(r.properties.scale=r.properties.width/5.4),r.properties.translate||(r.properties.translate=[r.properties.width/2,r.properties.height/2]),r.svg=t.append("svg").attr("width",r.properties.width).attr("height",r.properties.height),r.svg.append("rect").attr("class","background").attr("width",r.properties.width).attr("height",r.properties.height).on("click",r.clicked.bind(r));var a=r.properties.projection().scale(r.properties.scale).translate(r.properties.translate).precision(.1);a.hasOwnProperty("rotate")&&r.properties.rotate&&a.rotate(r.properties.rotate),r.path=i.geoPath().projection(a);Promise.resolve().then(function(){return r.properties.geoData?r.properties.geoData:o.json(r.properties.geofile)}).then(function(t){return function(t){r.geo=t,r.svg.append("g").attr("class","units zoom").selectAll("path").data(n.feature(t,t.objects[r.properties.units]).features).enter().append("path").attr("class",function(t){return"unit "+e.properties.unitPrefix+r.unitName(t.properties)}).attr("d",r.path).on("click",r.clicked.bind(r)).append("title").text(r.properties.unitTitle),r.update()}(t)})}},{key:"unitName",value:function(t){var e=t[this.properties.unitId];return void 0!==e?e.toString().trim().replace(/\s/g,"_"):""}},{key:"update",value:function(){this.properties.postUpdate&&this.properties.postUpdate()}}]),t}(),w=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}(r,m);var e=g(r);function r(){var t;c(this,r),t=e.call(this);var n={colors:r.DEFAULT_COLORS,column:null,domain:null,duration:null,format:s.format(",.02f"),legend:!1,valueScale:p.scaleQuantize};for(var o in n)t.properties[o]=n[o],y(h(t),o,n[o]);return t}return u(r,[{key:"columnVal",value:function(t){return+t[this.properties.column]}},{key:"defined",value:function(t){return!(isNaN(t)||void 0===t||""===t)}},{key:"update",value:function(){var t=this;t.extent=a.extent(t.data,t.columnVal.bind(t)),t.colorScale=t.properties.valueScale().domain(t.properties.domain||t.extent).range(t.properties.colors),t.svg.selectAll("path.unit").style("fill",null),t.data.forEach(function(e){var r=t.unitName(e),n=e[t.properties.column].toString().trim(),o=t.svg.selectAll(".".concat(t.properties.unitPrefix).concat(r));if(!o.empty()&&t.defined(n)){var i=t.colorScale(n),a=t.properties.unitTitle(o.datum());t.properties.duration?o.transition().duration(t.properties.duration).style("fill",i):o.style("fill",i),n=t.properties.format(n),o.select("title").text("".concat(a,"\n\n").concat(t.properties.column,": ").concat(n))}}),t.properties.legend&&t.drawLegend(t.properties.legend),v(f(r.prototype),"update",this).call(this)}},{key:"drawLegend",value:function(){var t,e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=this,o=n.properties.colors.length;!0===r?(t=n.properties.width/10,e=n.properties.height/3):(t=r.width,e=r.height);var i=t/7.5,a=e-e/5.4,p=i/2,s=n.properties.height-e,c="translate("+p+","+3*p+")";n.svg.select("g.legend").remove();var l=n.properties.colors.slice().reverse(),u=a/o,f=3/u,d=n.svg.append("g").attr("class","legend").attr("width",t).attr("height",e).attr("transform","translate(0,"+s+")");d.append("rect").style("fill","#fff").attr("class","legend-bg").attr("width",t).attr("height",e),d.append("rect").attr("class","legend-bar").attr("width",i).attr("height",a).attr("transform",c);var h=d.append("g").attr("transform",c);h.selectAll("rect").data(l).enter().append("rect").attr("y",function(t,e){return e*u}).attr("fill",function(t,e){return l[e]}).attr("width",i).attr("height",u);var g=n.extent[0],v=n.extent[1],y=!1,m=!1;n.properties.domain&&(n.properties.domain[1]<v&&(m=!0),v=n.properties.domain[1],n.properties.domain[0]>g&&(y=!0),g=n.properties.domain[0]),h.selectAll("text").data(l).enter().append("text").text(function(t,e){if(e===o-1){var r=n.properties.format(g);return y&&(r="< ".concat(r)),r}return n.properties.format(n.colorScale.invertExtent(t)[0])}).attr("class",function(t,e){return"text-"+e}).attr("x",i+p).attr("y",function(t,e){return e*u+(u+u*f)}),h.append("text").text(function(){var t=n.properties.format(v);return m&&(t="> ".concat(t)),t}).attr("x",i+p).attr("y",p*f*2)}}]),r}();w.DEFAULT_COLORS=["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],t.choropleth=function(){return new w},t.geomap=function(){return new m},Object.defineProperty(t,"__esModule",{value:!0})});
